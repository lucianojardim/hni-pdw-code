@model PDWModels.Companies.MyCompanyInfo
@{
	ViewBag.Title = "MyCompany";
	Layout = "~/Views/Shared/NewLayout.cshtml";
	ViewBag.HeaderArea = "Users";
}
<div class="container">
	<div class="main_inner1">
		<div class="territory-companyProfile">
			<!--left Column -->
			<div class="main_inner2_btm_2Col_Col marginTop30">
				<h2>
					@Model.CompanyName</h2>
				<div class="addrssColmn">
					@Model.Address1<br>
					@if( (Model.Address2 ?? "").Any() )
	 {
		 <text>
					@Model.Address2<br>
					</text>
					}
					@Model.City @Model.State @Model.Zip
				</div>
				<div class="phneFaxWebLblColmn marginTop30">
					Phone<br>
					Fax<br>
					Website
				</div>
				<div class="phneFaxWebInfoColmn marginTop30">
					@Model.PhoneNumber<br>
					@Model.FaxNumber<br>
					<a href="@Model.WebSite">@Model.WebSite</a>
				</div>
				@if( Model.IsTripIncentive )
	{
				<img src="/NewContent/images/incentiveFPO.jpg" alt="" width="455" height="207" class="incentiveImg" />
	}
			</div>
			<!--//END left Column -->
			<!--right Column -->
			<div class="main_inner2_btm_2Col_Col">
			<a href="#changeCompanyImage" id="changeCompanyImageLink">
				<img src="@(Model.ImageFileName == null ? "/NewContent/images/company-logo-placeholder.png" : ("/images/" + Model.ImageFileName))" alt="" style="max-width:450px;max-height:175px;" />
			</a>
			</div>
			<div class="clear"></div>
			<!--//END right Column -->
			<hr>
			<!-- registered user tablature data --->
			<!--<span class="flt_Rt"><img src="img/addPlusSig.jpg" width="15" height="15" />New User</span>-->
			<h4>Registered Users</h4>
			<table class="userTable" id="userList">
			</table>
			<!-- //END registered user tablature data --->
			<div class="clear">
			</div>
		</div>
	</div>
</div>

<div style="display:none;">
	<div id="changeCompanyImage">
    @using( Html.BeginForm( "MyCompanyImage", "User", FormMethod.Post, new { id = "theForm", name = "theForm", enctype = "multipart/form-data" } ) )
	{
		@Html.AntiForgeryToken()
		@Html.HiddenFor( m => m.CompanyID )
		<div class="main_inner2_btm"> 
			<div class="main_inner2_btm_mid_myacct">   
				<h4 class="bold">Update Company Image</h4> 
				<ul>
					<li>
						<div class="colmn3-1">Change Company Image</div>
						<div class="colmn3filebrowser"><input id="CompanyImage" name="CompanyImage" accept=".jpg,.png,.gif,.bmp" type="file"/></div>
					</li>              
				</ul>
				<div class="clear"></div>
				<div class="colmn1">Maximum file size is 450x175.</div>
			</div>
			<div class="clear"></div>
			<span class="btn7 cancelCIBtn">CANCEL</span> <span class="btn8 submitCIBtn">SAVE</span> 
		</div>
	}
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function () {
		loadUsers();

		$('#changeCompanyImageLink').fancybox({
			'autoDimensions': false,
			'width': 972,
			'height': 220,
			'padding': 20,
			'margin': 0,
			'scrolling': 'auto',
			'titleShow': false
		});

		$('.submitCIBtn').click(function (e) {
			$('#theForm').submit();
		});

		$('.cancelCIBtn').on('click', function() {
			$.fancybox.close();
		});
	});

	var uTable = null;
	function loadUsers() {
		if (uTable != null) {
			uTable.fnDraw();
			return;
		}

		uTable = $('#userList').dataTable({
			"bServerSide": true,
			"bAutoWidth": false,
			"bFilter": false,
			"bLengthChange": false, // don't show dropdown for #items per page
			"bPaginate": true,
			"bInfo": true,
			"sAjaxSource": '@Url.Action( "MyCompanyUserList", "User" )',
			"fnServerParams": function (aoData) {
				aoData.push({ "name": "companyId", "value": @Model.CompanyID });
			},
			"iDisplayLength": 100,
			"fnServerData": function (sSource, aoData, fnCallback) {
				makeAjaxCall(sSource,
					aoData,
					function (data, textStatus, jqXHR) {
						fnCallback(data, textStatus, jqXHR);
					},
					function (jqXHR, textStatus, errorThrown) { alert('Error getting list of Users:' + errorThrown) }
				);
			},
			"bProcessing": false, // don't want to use the default progress indicator at this time
			"aaSorting": [[1, "asc"]],
			"asStripeClasses": [],
			"aoColumnDefs": [
                    { "sName": "FirstName", "sTitle": "First Name<span></span>", "sClass": "hasSpan", "aTargets": [0], "mDataProp": "FirstName", "sWidth": "25%" },
                    { "sName": "LastName", "sTitle": "Last Name<span></span>", "sClass": "hasSpan", "aTargets": [1], "mDataProp": "LastName", "sWidth": "25%" },
                    { "sName": "Title", "sTitle": "Title<span></span>", "sClass": "hasSpan", "aTargets": [2], "mDataProp": "Title", "sWidth": "25%" },
                    { "sName": "Role", "sTitle": "Role<span></span>", "sClass": "hasSpan", "aTargets": [3], "mDataProp": "Role", "sWidth": "25%", "bSortable": false }
                ]
		});
	}

</script>